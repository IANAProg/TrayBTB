# TrayBTB

Простая утилита для Windows, показывающая заряд Bluetooth‑устройства в системном трее.

Кратко — что делает код сейчас
- Находит Bluetooth/аудио устройства через WMI (Win32_PnPEntity) и допрашивает Windows о батарее (DEVPKEY_Device_BatteryLevel) через PowerShell.
- В трее отображается иконка, цвет которой зависит от процента батареи (зелёный→красный).
- Через меню можно выбрать устройство для мониторинга; меню собирается динамически из найденных устройств.
- Поиск и опрос выполняются в фоновом потоке, чтобы не блокировать UI.
- Логирование в файл `logs/TrayBTB_*.log`.
- Уведомления (WinToast) при старте и при низком заряде (<=20%).

Требования
- Windows 10
- Bluetooth‑адаптер включён и устройство подключено/видимо в Windows.

Зависимости
- pystray
- pillow
- winotify
- pywin32
- (опционально) pwsh (PowerShell 7) для ускорения PowerShell‑вызовов

  
- После старта в трее появится иконка. Обновите список устройств и выберите устройство через меню.

Конфигурация / полезные параметры (в коде)
- `DeviceManager.get_devices()` — логика поиска устройств (WMI + параллельный PowerShell).
- Интервалы/таймауты: `update_interval` (главный цикл), таймауты PowerShell в `DeviceManager`.
- `self._minimal_menu_update_s` — минимальный интервал между пересборками меню (по умолчанию в коде можно менять для снижения зависаний).
- Файл логов: `logs/TrayBTB_<timestamp>.log`

Ограничения и советы
- Программа ориентирована на Windows и использует Windows‑специфичные API/PowerShell.
- Не все Bluetooth‑устройства предоставляют уровень батареи в Windows. Если устройство видимо в Settings → Bluetooth и там виден процент — скрипт обычно найдёт его; если нет — возможно устройство предоставляет данные только по BLE GATT (требует Bleak).
- Для ускорения PowerShell‑опросов рекомендуется установить PowerShell 7 (pwsh) — код автоматически использует его при наличии.

Дальнейшие идеи (опционально)
- Добавить опцию использовать Bleak для чтения GATT (Battery Service) для BLE‑устройств.
- Отображать числовой процент в иконке.
- GUI‑окно с детальной информацией по устройствам.
- Сделать возможность мониторинга сразу нескольких устройств (условно 3 устройства, 2 из них будут только вызывать уведомление о разряде и 1 активно мониториться в трее)
